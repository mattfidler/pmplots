---
title: "Available functions"
author: ""
date: ""
output:
  github_document:
    toc: true
---

```{r, echo=FALSE}
knitr::opts_chunk$set(comment='.', message=FALSE, warning=FALSE,
                      fig.path="img/everyfunction--",
                      fig.width=4, fig.height=4)
```


```{r}
library(pmplots)
library(dplyr)
library(mrggsave)
```


# Example data in the package
```{r}
df <- superset2() %>% filter(EVID==0)

id <- distinct(df, ID, .keep_all=TRUE)

dayx <- defx(breaks = seq(0,168,24))
.yname <- "NoDoz (ng/mL)"
```

Override the `df` and `id` objects in the above chunk
```{r}
## Nothing here
```


# `col//title` specification

This is a way to specify the column name for source
data along with the axis label
col_label("CL//Clearance (L)")


# Observed vs predicted
## Observed versus population predicted (`dv_pred`)

```{r}
dv_pred(df, yname = .yname)
```

### Observed versus population predicted - log/log
```{r}
dv_pred(df, loglog=TRUE, yname = .yname)
```

## Observed versus individual predicted (`dv_ipred`)
```{r}
dv_ipred(df, yname=.yname)
```

### Observed versus individual predicted - log/log
```{r}
dv_ipred(df, loglog=TRUE, yname = .yname)
```


# Residual plots

## Residuals

### Residuals versus time (`res_time`)
```{r}
res_time(df)
```

### Residuals versus time after first dose (`res_tafd`)
```{r,eval=FALSE}
res_tafd(df)
```


### Residuals versus time after dose (`res_tad`)
```{r}
res_tad(df)
```

### Residuals versus population predicted (`res_pred`)
```{r}
res_pred(df)
```

### RES versus continuous covariate (`res_cont`)
```{r}
res_cont(df, x="WT//Weight (kg)")
```

### RES by categorical covariate (`res_cat`)
```{r}
dplyr::count(df, STUDYc)
res_cat(df, x="STUDYc//Study type")
```


## Weighted residuals

### Weighted residuals versus time (`wres_time`)
```{r}
wres_time(df) 
```

### Weighted residuals versus time after first dose (`wres_tafd`)
```{r,eval=FALSE}
wres_tafd(df)
```


### Weighted residuals versus time after dose (`wres_tad`)
```{r}
wres_tad(df)
```

### Weighted esiduals versus population predicted (`wres_pred`)
```{r}
wres_pred(df)
```

### WRES versus continuous covariate (`wres_cont`)
```{r}
wres_cont(df, x="WT//Weight (kg)")
```

### WRES by categorical covariate (`wres_cat`)
```{r}
wres_cat(df, x="STUDYc//Study type")
```


### WRES QQ plot (`wres_q`)
```{r}
wres_q(df)
```


## Conditional weighted residuals (CWRES)

### CWRES versus time (`cwres_time`)
```{r}
cwres_time(df)
```


### Conditional weighted residuals versus time after first dose (`cwres_tafd`)
```{r,eval=FALSE}
cwres_tafd(df)
```


### CWRES versus time after dose (`cwres_tad`)
```{r}
cwres_tad(df)
```

### CWRES versus continuous covariate (`cwres_cont`)
```{r}
cwres_cont(df, x="WT//Weight (kg)")
```

### CWRES by categorical covariate (`cwres_cat`)
```{r}
cwres_cat(df, x="STUDYc//Study type")
```

```{r}
cwres_cat(df, x="STUDYc//Study type", shown=FALSE)
```

### CWRES versus population predicted (`cwres_pred`)
```{r}
cwres_pred(df)
```

### CWRES QQ plot (`cwres_q`)
```{r}
cwres_q(df)
```

# ETA plots

## ETA versus continuous covariates (`eta_cont`)

```{r}
etas <- c("ETA1//ETA-CL", "ETA2//ETA-V2", "ETA3//ETA-KA")
p <- eta_cont(id, x="WT//Weight (kg)",y=etas)
```

```{r, fig.width=6, fig.height=7}
mrggdraw(p, ncol=2, arrange=TRUE, script="everyfunction.R")
```



## ETA by categorical covariates (`eta_cat`)

```{r}
p <- eta_cat(id, x="STUDYc//Study type", y=etas)
```


```{r, fig.width=6, fig.height=7}
mrggdraw(p, ncol=2, arrange=TRUE, script="everyfunction.R")
```

## ETA histograms (`eta_hist`)
```{r}
etas <- c("ETA1//ETA-CL", "ETA2//ETA-V2", "ETA3//ETA-KA")
p <- eta_hist(id,etas, bins=10)
```

```{r,fig.width=6, fig.height=7}
mrggdraw(p, ncol=2, arrange=TRUE, script="everyfunction.R")
```


## ETA pairs plot (`eta_pairs`)

```{r}
p <- eta_pairs(id,etas)
```


```{r,fig.width=6, fig.height=7}
print(p)
```



# DV versus time (`dv_time`)

## Basic plot

```{r}
dv_time(df, yname = .yname)
```


## Faceted

```{r,fig.width=6, fig.height=7}
dv_time(df, yname="NoDoze (ng/mL)") +
  facet_wrap(~DOSE, scales="free_x")
```


## log-Scale
```{r,fig.width=6, fig.height=6}
dv_time(df, yname="NoDoze (ng/mL)", log=TRUE) +
  facet_wrap(~STUDYc)
```


# Data summary

## Continuous variable by categorical variable (`cont_cat`)
```{r}
cont_cat(id, x="STUDYc//Study name", y="WT//Weight (kg)")
```


## Split and plot (`split_plot`)
```{r}
p <- split_plot(df, sp="STUDYc", fun=dv_ipred)
```

```{r,fig.width=6, fig.height=7}
mrggdraw(p, arrange=TRUE, script="everyfunction.R")
```


# Some customization

## Modify x-axis

```{r}
a <- list(trans="log", breaks = logbr3())

dv_time(df, xs=a)
```

## Modify y-axis
```{r}
dv_time(df, ys=a, yname="Y-axis name")
```


## Drop extra layers
```{r}
dv_pred(df, smooth=NULL)
```

```{r}
dv_pred(df, abline=NULL)
```

```{r}
dv_pred(df, abline=NULL, smooth = NULL)
```


```{r}
cwres_time(df, hline = NULL)
```






## Custom breaks

Default breaks:
```{r}
dv_time(df)
```

Break every 3 days
```{r}
dv_time(df, xby=72)
```

Custom breaks and limits
```{r}
a <- list(br = seq(0,240,48), limits=c(0,240))
dv_time(df, xs=a)
```


## Extra reference lines to [C]WRES plots

```{r}
wres_time(df) + geom_3s()
```


# Controlled input / output
```{r}
dd <- df

dd$PRED <- 2*dd$DV
dv_pred(dd)
dd$IPRED <- 3*dd$DV
dv_ipred(dd)
dd$RES <- 2*dd$TIME
res_time(dd)
dd$WRES <- 10*dd$TIME
wres_time(dd)
dd$CWRES <- 100*dd$TIME
cwres_time(dd)
```



```{r}
cwres_cont(dd, x = "RES//Controlled")
```

Should be fairly flat
```{r}
dd$CWRESQ <- rnorm(nrow(dd))
cwres_q(dd,x="CWRESQ")
```





# Plot output (`mrggsave`)

## Saving single plots
```{r}
p1 <- dv_pred(df)
```


```{r,eval=FALSE}
mrggsave(p1, script="everyfunction.R", stem="figure1")
```


## Save multiple plots to one file
```{r}
p2 <- dv_ipred(df)
p3 <- cwres_pred(df)
p4 <- cwres_time(df)
```

```{r,eval=FALSE}
mrggsave(list(p1,p2,p3,p4), script="everyfunction.R", stem="figure1")
```

## Arrange multiple plots on a single page

```{r, fig.width=6, fig.height=7}
mrggdraw(list(p1,p2,p3,p4), arrange=TRUE, script="everyfunction.R")
```



